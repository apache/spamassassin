#!/bin/sh

WEBDIR=/www/spamassassin.apache.org
vers=3.2.x

if [ -z "$PERL" ]; then
  if [ -x /home/jm/perl584/bin/perl ]; then
    PERL=/home/jm/perl584/bin/perl
  else
    PERL=perl
  fi
fi

fulldir=$WEBDIR/full/$vers
[ -d $fulldir ] || mkdir -p $fulldir

$PERL Makefile.PL PERL=$PERL < /dev/null
make
make text_html_doc || exit 1

rm -rf $fulldir/dist
mkdir $fulldir/dist
tar cf - \
        --exclude=CVS --exclude='.#*'  \
        --exclude=.svn \
        --exclude='logs' --exclude='*.tar.gz' --exclude='*.zip' \
        --exclude='*.log' --exclude='*.o' \
        --exclude='o' --exclude='out' \
        --exclude='tst' \
        --exclude='blib' --exclude='Mail-SpamAssassin-*' \
        . | ( cd $fulldir/dist ; tar xf - )
        
(
  cd $fulldir/dist
  tar cf docbak doc
  make clean distclean
  tar xvf docbak
  rm -f docbak
)

chmod -R g+w $fulldir/dist

